# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
  batch: flase
  branches:
  include: 
    - main 

pr: 
  autoCancel: false
  drafts: true
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

stages: 
  - stage: Build
    jobs:  
      - job: Build
        displayName: build

        steps:
          - checkout: self
            clean: true
            persistCredentials: true
            displayName: Checkout

          - task: Npm@1
            inputs:
              customCommand: 'install -g npm@$(npmVersion)'
            displayName: Npm Install $(npmVersion)

          - task: Npm@1
            inputs:
              command: ci
              customRegistry: 'useFeed'
            displayName: Install
          
          - task: Npm@1
            inputs:
              command: custom
              customCommand: run test:unit
              customRegistry: 'useFeed'
            displayName: Unit Tests

          - script: |
             npm install
             npm run build:android
            displayName: Build Android
          
          - script: | 
             npm install
             npm run build:ios
            displayName: Build IOS


